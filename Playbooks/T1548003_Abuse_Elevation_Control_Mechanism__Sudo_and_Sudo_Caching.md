# Abuse_Elevation_Control_Mechanism:_Sudo_and_Sudo_Caching - T1548003

| Column Name | Value |
|-------------|-------|
| MITRE Tactic | Defense Evasion, Privilege Escalation |
| MITRE TTP | T1548.003 |
| MITRE Sub-TTP | T1548.003 |
| Name | Abuse Elevation Control Mechanism: Sudo and Sudo Caching |
| Log Sources to Investigate | Investigate system logs such as /var/log/auth.log on Linux and /var/log/secure.log on macOS to capture sudo command executions and modifications to the /etc/sudoers file. Additionally, monitor for changes in files within /var/db/sudo and command history logs (e.g., ~/.bash_history or equivalent shell history files). Also, review process monitoring data to identify unexpected executions of 'echo Defaults !tty_tickets >> /etc/sudoers' and 'killall Terminal'. Examine logs from security solutions that monitor file integrity, like OSSEC or auditd, for unauthorized changes to sudoers-related files. |
| Key Indicators | Key indicators include unexpected or unauthorized modifications to the /etc/sudoers file, especially entries like 'NOPASSWD: ALL'. Changes or accesses to /var/db/sudo without corresponding legitimate sudo commands being executed. Detection of 'Defaults !tty_tickets' being added to /etc/sudoers, or instances of 'killall Terminal' commands executed at unusual times. Anomalous high-privilege command lines without the expected password prompt based on log entries. |
| Questions for Analysis | 1. Has there been any recent unauthorized access or modification to the /etc/sudoers file?<br>2. Are there legitimate reasons for the modifications observed (e.g., sanctioned administrative tasks)?<br>3. Is 'NOPASSWD: ALL' or 'Defaults !tty_tickets' present in the /etc/sudoers configuration without prior approval? 4. Have there been recent or unusual sudo command invocations that bypass password prompts? 5. Have other indicators of compromise been triggered in conjunction with these activities? |
| Decision for Escalation | Escalate to Tier 2 if unauthorized changes to sudoers-related files are confirmed, especially if they include 'NOPASSWD' entries or 'tty_tickets' modifications. Also, escalate if there are unidentified processes executing high-privilege commands without audit trails or if malware artifacts align with known methods of privilege escalation like those detailed in the provided TTP. |
| Additional Analysis Steps for L1 | Verify recent modifications in the /etc/sudoers file against authorized change records. Cross-reference sudo command logs with user login sessions to validate legitimate usage. Check for the consistent presence of security updates to sudo and related policy files. Validate if any legitimate scripts require the configuration changes seen in the sudoers file. |
| T2 Analyst Actions | Perform a thorough investigation of user accounts involved in suspicious sudo activities. Check for malware signatures or behavior consistent with abuse of sudo elevation. Analyze the execution context of changes to the sudoers file, such as existing shell scripts or unauthorized remote access. Engage with IT or system administrators to validate potential misconfigurations or maintenance activities. |
| Containment and Further Analysis | Revert any unauthorized changes to the sudoers file and restore configurations from backups. Perform a root cause analysis to determine the vector used for unauthorized changes. Implement stricter authentication and validation checks for sudo usage, possibly including two-factor authentication. Consider deploying additional monitoring or endpoint protection to prevent recurrences. Collaborate with IT teams to patch or harden systems against this form of privilege escalation. |
