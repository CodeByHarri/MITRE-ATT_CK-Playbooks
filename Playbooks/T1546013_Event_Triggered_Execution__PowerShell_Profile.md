# Event_Triggered_Execution:_PowerShell_Profile - T1546013

| Column Name | Value |
|-------------|-------|
| MITRE Tactic | Persistence, Privilege Escalation |
| MITRE TTP | T1546.013 |
| MITRE Sub-TTP | T1546.013 |
| Name | Event Triggered Execution: PowerShell Profile |
| Log Sources to Investigate | Monitor PowerShell ScriptBlock Logging (security log events 4104) to detect execution of potentially malicious commands within PowerShell sessions. Look for any changes to PowerShell profile files, which can be identified in File Auditing logs (enable auditing on profile.ps1 path). Use Windows Event logs (event ID 4688) to track process creation events indicating PowerShell executions and examine any unusual execution patterns. Additionally, review Windows Defender or other AV/EDR logs for alerts on potential threats triggered by PowerShell activity. |
| Key Indicators | Detection of unusual modifications to any profile.ps1 files that aren't associated with expected system or user activity. Initiation of PowerShell sessions without the -NoProfile flag following a change to profile.ps1. Frequency of PowerShell executions that significantly deviate from normal user behavior, especially those with high privileges. Event 4104 logs capturing suspicious commands activated through a modified PowerShell profile. |
| Questions for Analysis | Is the modification to the profile.ps1 associated with a known and authorized change? Have similar PowerShell modifications been observed on other systems within the network? Are there reports from users about unexpected behavior in PowerShell sessions? Is the user account exhibiting other indicators of potentially compromised activity, such as unusual login attempts? |
| Decision for Escalation | Escalate if you identify unauthorized changes to PowerShell profiles, the presence of suspicious or obfuscated commands in ScriptBlock logs, or when anomalous PowerShell activity is linked to sensitive accounts like domain admins. Escalation should also be considered if these activities cannot be justified by routine operations or administrative tasks. |
| Additional Analysis Steps for L1 | Verify when and by whom the profile.ps1 file was last modified. Cross-reference the time and user account with known change management records or reported activities. Check whether the -NoProfile option was used in regular operational PowerShell executions. Gather information on any AV alerts related to PowerShell and determine if they correlate with the suspicious profile modifications. |
| T2 Analyst Actions | Perform a more in-depth analysis of the content of the modified profile.ps1 file to identify potentially malicious scripts. Analyze recent network connections from the affected account or machine for suspicious activities or known malicious IPs/C2 servers. Investigate linked accounts for signs of lateral movement or privilege escalation. Validate the integrity and authenticity of the PowerShell environment using hashes or checksums. |
| Containment and Further Analysis | Isolate affected systems to prevent further unauthorized actions. Restore modified or tampered profile.ps1 files from backup, confirming they are clean versions. Implement monitoring to alert for further attempts to modify PowerShell profiles. Conduct a full system forensic investigation to identify scope and impact, including any credential theft or data exfiltration activities. Review and enhance user awareness training regarding the risks of PowerShell misuse. |
