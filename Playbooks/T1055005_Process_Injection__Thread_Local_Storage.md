# Process_Injection:_Thread_Local_Storage - T1055005

| Column Name | Value |
|-------------|-------|
| MITRE Tactic | Defense Evasion, Privilege Escalation |
| MITRE TTP | T1055.005 |
| MITRE Sub-TTP | T1055.005 |
| Name | Process Injection: Thread Local Storage |
| Log Sources to Investigate | Investigate the following log sources to detect potential TLS callback injection activities: 1. Windows Security Event Logs - Focus on events related to process creation (Event ID 4688) and module loading (Event ID 4689) to determine if unusual DLLs or modules are being loaded into processes.<br>2. Application logs - Check for anomalous behavior or crashes in applications that could indicate injection.<br>3. Endpoint Detection and Response (EDR) logs - Look for alerts related to process injection and inspect memory allocation patterns. 4. Process and Memory Monitoring Tools - Use tools like Sysmon to identify process memory modifications or unusual thread activity. |
| Key Indicators | 1. Abnormal process behavior, such as a process executing code right after a new thread is created.<br>2. Changes to the Thread Local Storage entries of a process shortly after its start.<br>3. Memory regions marked executable that weren't a part of the original process image memory layout. 4. Unusual DLLs or executables loaded by processes, especially if they are associated with known malicious signatures. 5. High privilege processes exhibiting suspicious code execution patterns. |
| Questions for Analysis | 1. Are there recent legitimate changes or updates to software that could explain a new TLS callback?<br>2. Is there a known legitimate reason for the process to have modified Thread Local Storage?<br>3. Are the processes involved typically running with elevated privileges, making them attractive targets for injection? 4. Have there been any similar detections or anomalies observed in other parts of the network that could indicate broader compromise? |
| Decision for Escalation | Escalate to Tier 2 if: 1. There is confirmed unauthorized modification to Thread Local Storage without a legitimate reason.<br>2. The affected process has elevated privileges or access to sensitive data/resources.<br>3. Other indicators of compromise, such as abnormal process spawning or communication with known malicious IPs, are observed. 4. The injection involves critical infrastructure or sensitive environments. |
| Additional Analysis Steps for L1 | 1. Review the logs for any similar or precursory activities that could provide context to the injection event.<br>2. Correlate the suspicious process activity with known malware signatures or threat intelligence indicators.<br>3. Conduct a basic timeline analysis to determine the sequence of events leading up to the detection. 4. Identify all processes and users involved, and note any anomalies in their typical behavior. |
| T2 Analyst Actions | 1. Perform memory dumps of the affected process for deep analysis.<br>2. Utilize reverse engineering techniques to analyze any malicious executables or DLLs found in the process.<br>3. Investigate network traffic patterns from the compromised host to identify potential C2 communication. 4. Collaborate with incident response teams to determine the scope and impact of the intrusion, and begin drafting a containment strategy. |
| Containment and Further Analysis | 1. Isolate the affected host to prevent lateral movement or further damage.<br>2. Revoke any compromised credentials associated with the impacted processes or users.<br>3. Use forensic tools to analyze memory dumps and identify any remaining injected code fragments or payloads. 4. Implement stricter monitoring and detection mechanisms for process modifications and injection attempts based on learned behaviors from the incident. 5. Report findings to stakeholders and update threat models and mitigation strategies based on lessons learned. |
