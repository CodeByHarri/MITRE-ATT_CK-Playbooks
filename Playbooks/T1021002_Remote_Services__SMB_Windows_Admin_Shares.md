# Remote_Services:_SMB_Windows_Admin_Shares - T1021002

| Column Name | Value |
|-------------|-------|
| MITRE Tactic | Lateral Movement |
| MITRE TTP | T1021.002 |
| MITRE Sub-TTP | T1021.002 |
| Name | Remote Services: SMB/Windows Admin Shares |
| Log Sources to Investigate | To identify potential exploitation of SMB/Windows Admin Shares, review the following log sources: 1. Windows Security Event Logs: Look for Event ID 4624 (An account was successfully logged on) and Event ID 5140 (A network share object was accessed).<br>2. SMB Session Logs: Capture and analyze logs related to SMB communications, including logs from Windows servers and network appliances that monitor SMB traffic.<br>3. Network Traffic Logs: Use network monitoring tools to inspect connections to administrative shares, specifically looking at SMB traffic on ports 139 and 445. 4. Endpoint Detection and Response (EDR) tools: Collect and analyze data on process execution and file transfers. 5. Authentication Logs: Check for unusual authentication attempts, especially those involving privileged accounts or multiple failures followed by a success. |
| Key Indicators | 1. Unusual access to hidden shares such as C$, ADMIN$, and IPC$.<br>2. Unexpected file transfers or remote executions originating from administrative shares.<br>3. Authentication using NTLM hashes instead of plaintext passwords, indicative of potential Pass the Hash attacks. 4. Sudden access from unfamiliar or non-typical hosts to sensitive SMB shares. 5. High number of authentication attempts from one source, possibly indicating brute force attempts or credential stuffing. |
| Questions for Analysis | 1. Is the source IP address of the SMB access request known and legitimate?<br>2. Is there evidence of abnormal login patterns or use of accounts at unusual times?<br>3. Were the accessed files on the admin shares expected operations for the user account involved? 4. Are there concurrent alerts or logs indicating lateral movement or privilege escalation? 5. Was a legitimate administrative tool used in an unusual or unexpected manner? |
| Decision for Escalation | Escalate to Tier 2 if: 1. SMB access or file transfer originates from an unrecognized source or involves suspicious file names.<br>2. Authentication attempts are made using NTLM hashes, indicating a potential Pass the Hash attack.<br>3. There are concurrent signs of potential lateral movement, privilege escalation, or unauthorized access patterns. 4. EDR signals execution of uncommon binaries via SMB shares. |
| Additional Analysis Steps for L1 | 1. Investigate the source of the SMB access or file transfer for legitimacy.<br>2. Correlate the events with known business operations or legitimate administrative activities.<br>3. Verify if the accessed SMB shares and associated files are part of routine access patterns for the user account involved. 4. Cross-reference timestamps with other security logs to identify additional suspicious activity. 5. Look for failed login attempts preceding the successful access, indicating possible brute-force attempts. |
| T2 Analyst Actions | 1. Review detailed log data and correlating activities surrounding the detection event, including network traffic and user activity.<br>2. Conduct a more in-depth review of the involved accounts, including recent authentication and authorization logs.<br>3. Assess system configurations and patches to understand potential vulnerabilities. 4. Contact stakeholders to verify legitimacy of detected activities. 5. Use forensic tools to analyze accessed or modified files for signs of tampering or malicious payloads. |
| Containment and Further Analysis | 1. Initiate containment procedures to limit further SMB access if malicious activity is suspected.<br>2. Disable or change credentials for compromised accounts.<br>3. Isolate affected systems to prevent further lateral movement. 4. Conduct a detailed post-incident analysis on file access and system integrity. 5. Apply necessary patches and harden configurations of SMB services and administrative share settings. 6. Follow up with a security awareness session for users on the proper handling of credentials. |
