# Event_Triggered_Execution:_Unix_Shell_Configuration_Modification - T1546004

| Column Name | Value |
|-------------|-------|
| MITRE Tactic | Persistence, Privilege Escalation |
| MITRE TTP | T1546.004 |
| MITRE Sub-TTP | T1546.004 |
| Name | Event Triggered Execution: Unix Shell Configuration Modification |
| Log Sources to Investigate | Monitor changes to Unix shell configuration files such as /etc/profile, /etc/profile.d/, ~/.bash_profile, ~/.bash_login, ~/.profile, ~/.bashrc, ~/.bash_logout, /etc/zshenv, /etc/zprofile, /etc/zlogin, ~/.zprofile, ~/.zlogin, ~/.zshrc, /etc/zlogout, and ~/.zlogout. File modification logs via auditd or similar tools can capture changes to these files. Look for unexpected entries or modifications. For macOS, additionally monitor logs for Terminal.app activity and zsh shell execution. |
| Key Indicators | Unexpected changes to shell configuration files, such as additional lines or scripts that weren't present before. Modifications that include calls to external binaries or scripts that seem out of place. New entries with execution permissions set, particularly those that invoke network calls or external downloads. |
| Questions for Analysis | 1. Were there any recent system updates or legitimate administrative activities that could explain changes to these shell configuration files?<br>2. Do the modifications include calls to known malware domains or IP addresses?<br>3. Are there any signs of unexpected root-level permissions being used to modify system-wide configuration files?<br>4. Have other security alerts been triggered around the same timeframe that could corroborate suspicious activity? |
| Decision for Escalation | Escalate if: Unauthorized modifications to shell configuration files are detected, especially if they include calls to external malicious domains or binaries. Unexpected usage of root or elevated privileges when modifying system-wide configuration files. Correlated security alerts or indicators pointing towards potential compromise. |
| Additional Analysis Steps for L1 | Review historical logs for anomalies or patterns in file modification times that align with suspicious activity. Analyze user activity logs to identify if the user under whom changes were made had authorized access during the times of modification. Verify if changes match known threat actor TTPs or IOCs. |
| T2 Analyst Actions | Conduct a deeper forensic analysis of the modified files to determine if the changes are malicious. Use threat intelligence to identify any scripts or binary references to known IOCs. Check system processes and network activity for any ongoing malicious activities initiated due to these modifications. Liaise with system administrators to verify the legitimacy of file changes. |
| Containment and Further Analysis | If found malicious, revert unauthorized changes in the configuration files. Isolate affected systems to prevent further spread. Use endpoint detection and response (EDR) tools to identify and quarantine associated malicious files or processes. Conduct a full malware sweep on affected systems and network segments. Perform a thorough investigation to assess the extent of the compromise, possibly involving re-imaging affected machines if necessary. |
