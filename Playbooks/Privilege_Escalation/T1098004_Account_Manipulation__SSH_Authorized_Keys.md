# Account_Manipulation:_SSH_Authorized_Keys - T1098004

| Column Name | Value |
|-------------|-------|
| MITRE Tactic | Persistence, Privilege Escalation |
| MITRE TTP | T1098.004 |
| MITRE Sub-TTP | T1098.004 |
| Name | Account Manipulation: SSH Authorized Keys |
| Log Sources to Investigate | 1. File Integrity Monitoring: Logs from file integrity monitoring solutions that track changes to files in user home directories, specifically the <user-home>/.ssh/authorized_keys file.<br>2. System Logs: Local system logs, like /var/log/auth.log on Linux, for evidence of SSH access or modifications.<br>3. Cloud Environment Logs: Logs from cloud service providers (e.g., Google Cloud, Azure) that log metadata changes, especially those related to SSH key changes or modifications to VM instances. 4. Network Device Logs: Logs from network monitoring solutions that can track changes such as those implemented with commands like ip ssh pubkey-chain in network devices. |
| Key Indicators | 1. Unusual or unexpected changes to the <user-home>/.ssh/authorized_keys file, especially outside normal administrative activities.<br>2. Metadata updates in cloud environments that include SSH public key changes, such as through the Google Cloud add-metadata command or Azure PATCH requests to the API.<br>3. Increase in successful SSH authentications from previously unseen or unauthorized keys. 4. Network traffic anomalies indicating SSH communication from unrecognized sources or accounts. |
| Questions for Analysis | 1. Were there any authorized changes scheduled for the <user-home>/.ssh/authorized_keys file at the time of the modification?<br>2. Has the SSH key (or corresponding fingerprint) been previously used or audited in the environment?<br>3. Was there a legitimate admin console session or maintenance window during which these changes could have occurred? 4. Are there concurrent unauthorized access attempts from the IP address or user that introduced the change? |
| Decision for Escalation | Escalate to Tier 2 if: 1. Modifications were made to the authorized_keys file with no corresponding scheduled maintenance.<br>2. The SSH key noted in the change does not correspond to documented or approved keys in the key management database.<br>3. The same or similar SSH modifications are observed in multiple instances, suggesting potential lateral movement. |
| Additional Analysis Steps for L1 | 1. Verify the timestamp of modification and cross-reference with authorized change windows.<br>2. Identify the user's identity or process that initiated the modification using system audit logs.<br>3. Check if there is any unusual login or SSH activity originating from the user's account, especially those correlating with foreign IP addresses. |
| T2 Analyst Actions | 1. Perform deep packet analysis on suspicious SSH network traffic for deeper investigation.<br>2. Cross-reference the SSH key's fingerprint with known malicious signatures or previously blacklisted keys.<br>3. Review cloud provider audit logs for additional unauthorized changes to related resources or privileges. 4. Validate the permissions and roles assigned to any user or VM instance that exhibits suspicious SSH modifications. |
| Containment and Further Analysis | 1. Immediately disable or remove suspicious SSH keys added to the authorized_keys files.<br>2. For cloud environments, enforce stringent IAM controls, ensuring least-privilege and key management best practices.<br>3. Initiate thorough account reviews and credential resets for affected or potentially affected accounts. 4. Collaborate with incident response teams to assess the potential for a larger compromise and prepare communication plans for affected stakeholders. |
