# Virtualization_Sandbox_Evasion:_System_Checks - T1497001

| Column Name | Value |
|-------------|-------|
| MITRE Tactic | Defense Evasion, Discovery |
| MITRE TTP | T1497.001 |
| MITRE Sub-TTP | T1497.001 |
| Name | Virtualization/Sandbox Evasion: System Checks |
| Log Sources to Investigate | To investigate Virtualization/Sandbox Evasion through System Checks (T1497.001), relevant log sources include: <br>- Windows Event Logs, particularly 'System' and 'Application' logs, to detect unusual process executions or system information queries.<br>- PowerShell logs, especially Module Logging and Script Block Logging, to identify script-based automation conducting evasion checks.<br>- Windows Management Instrumentation (WMI) logs, which could reveal queries for virtualization indicators.<br>- Registry access logs for queries that target keys known to contain virtualization details.<br>- Networking logs for unusual queries or traffic patterns that may align with VM checks.<br>- Endpoint Detection and Response (EDR) solutions to provide detailed process execution chains and filesystem activity.<br>Examples: Event ID 4688 for process creation, Event ID 4104 for PowerShell activities. |
| Key Indicators | Typical indicators associated with system checks for virtualization/sandbox detection include:<br>- Execution of specific commands like 'systeminfo' or PowerShell scripts that query CPU, memory, or network adapter attributes.<br>- Access to registry paths linked to virtual machine software, such as 'HKEY_LOCAL_MACHINE\SOFTWARE\VMware, Inc.' or 'HKEY_LOCAL_MACHINE\HARDWARE\DESCRIPTION\System'.<br>- Processes running under suspicious or unusual filenames related to malware analysis, such as 'sample.exe'.<br>- High frequency of hybrid analysis platform-specific network patterns or service enumeration (checks for services exclusive to known VM software).<br>- Use of identified I/O ports for interfacing with VMware or other virtualization tools. |
| Questions for Analysis | 1. Are there any known legitimate reasons (like IT asset management or monitoring tools) for these system check activities on this host?<br>2. Do these activities correlate with recently scheduled administrative tasks or application updates?<br>3. Has this host been previously flagged for potential compromise or unusual behavior?<br>4. Are there repeated or script-like patterns in the commands or queries logged during the period of observed activity?<br>5. Do log entries show back-to-back execution with additional suspicious activities, such as payload drops or system modifications? |
| Decision for Escalation | Escalate to Tier 2 if:<br>- There's no legitimate justification for observed activities.<br>- Activities coincide with processes originating from previously unseen or untrusted applications.<br>- Correlation with other alerts involving potential malicious activity or indicators of compromise (IOCs).<br>- If system checks are part of a broader sequence observed in attack frameworks such as MITRE ATT&CK patterns. |
| Additional Analysis Steps for L1 | 1. Verify the triggering accounts and their normal usage (e.g., for admin tasks).<br>2. Cross-reference any listed hash or file path with known threat intelligence feeds.<br>3. Review surrounding process activities for deviations from established baselines.<br>4. Investigate whether these checks are the first in a sequence followed by potentially harmful actions, such as payload execution.<br>5. Document any other anomalies found during the same timeline, focusing on the host's outbound network connections. |
| T2 Analyst Actions | 1. Perform deep-dive analysis into process lineage around suspicious activities.<br>2. Utilize sandbox environments to simulate file behavior if any files seem suspicious.<br>3. Compare suspicious scripts or queries against known evasion techniques databases.<br>4. Liaise with system administrators to verify if there are any newly configured applications or updates aligning with recent log events. |
| Containment and Further Analysis | 1. If confirmed malicious, isolate the affected host from the network to limit potential lateral movement.<br>2. Preserve artifacts such as memory dumps and suspicious script files for forensic analysis.<br>3. Conduct thorough endpoint scans to identify additional IOCs or artifacts of compromise.<br>4. Engage in comprehensive threat hunting for similar activities across the enterprise.<br>5. Refine detection mechanisms based on investigation findings to mitigate future occurrences. |
