# Process_Injection:_Process_Doppelgänging - T1055013

| Column Name | Value |
|-------------|-------|
| MITRE Tactic | Defense Evasion, Privilege Escalation |
| MITRE TTP | T1055.013 |
| MITRE Sub-TTP | T1055.013 |
| Name | Process Injection: Process Doppelgänging |
| Log Sources to Investigate | 1. Windows Security Event Logs: Look for suspicious process creation and termination events, particularly around the time the doppelgänging activity is suspected.<br>2. File Integrity Monitoring Systems: Detects changes to executable files, which might correlate with the 'Transact' phase even if rolled back.<br>3. Process Monitoring Tools: Capture the sequence of creating and launching processes to identify suspicious patterns. 4. EDR (Endpoint Detection and Response) Solutions: Comprehensive tracking of process injections, memory manipulations, and system transactions. Example: Microsoft Defender ATP, CrowdStrike Falcon. 5. Transactional NTFS Logs: If available, these can offer insights into TxF-enabled handles and operations. 6. Memory Analysis Tools: Use tools like Volatility during a forensic investigation to detect anomalies in process memory states. |
| Key Indicators | 1. Creation of transactions using executable files with the TxF API that do not commit changes.<br>2. High frequency of process memory manipulations without corresponding legitimate update activities.<br>3. Absence of typical API calls like NtUnmapViewOfSection, VirtualProtectEx, and SetThreadContext in the process space where code injection is later discovered. 4. Unexpected process executions where the parent process is not typically associated with that child process, pointing towards the 'Animate' stage. 5. Anomalies in legitimate processes behaving unexpectedly or exhibiting unusual memory sections. |
| Questions for Analysis | 1. Are there any unusual or rare process creation patterns observed related to the suspected timeframe?<br>2. Does the process being investigated have any known vulnerabilities or weak configurations that could allow for exploitation via doppelgänging?<br>3. Are there anomalies in transaction log activities associated with the process doppelgänging stages? 4. Is there other correlated suspicious activity on the same endpoint or across the organization that aligns with the timeline? 5. Do any known Indicators of Compromise (IOCs) from threat intelligence apply to the processes or files involved? |
| Decision for Escalation | Escalate to Tier 2 if: 1. There is confirmed memory alteration of a process without legitimate cause.<br>2. High-confidence Indicators of Compromise (IOCs) are matched.<br>3. Cross-referenced suspicious activities widen the scope beyond a single machine hinting at lateral movement. 4. Process behavior or system logs cannot conclusively prove legitimate use or coincidence. 5. If the process involves critical systems or high-value information assets. |
| Additional Analysis Steps for L1 | 1. Verify the legitimacy of the parent and child processes involved.<br>2. Correlate suspicious events with known benign software updates or installations during the given period.<br>3. Gather baseline behavior data to identify deviations potentially linked to doppelgänging. 4. Check for recent alerts or anomalies in shared systems, considering possible lateral movement. |
| T2 Analyst Actions | 1. Perform a deeper memory analysis using a forensic toolset to identify stealth injections.<br>2. If a transaction rollback is suspected, verify with file integrity checks and correlate logs to match timestamps of events.<br>3. Review additional artifacts such as network logs to detect any command and control (C2) communication. 4. Cross-reference internal findings with external threat intelligence for patterns or emerging threats. |
| Containment and Further Analysis | 1. Quarantine affected machines immediately to prevent further malicious activities.<br>2. Block or monitor suspicious IP addresses for potential C2 connections.<br>3. Implement enhanced logging for the affected endpoints or similar systems in the network. 4. Use forensic tools to capture memory dumps and disk images for deeper analysis. 5. Engage incident response to understand the full scope and stimulate future preventive measures, e.g., patching, updating security policies. |
