# Hide_Artifacts:_VBA_Stomping - T1564007

| Column Name | Value |
|-------------|-------|
| MITRE Tactic | Defense Evasion |
| MITRE TTP | T1564.007 |
| MITRE Sub-TTP | T1564.007 |
| Name | Hide Artifacts: VBA Stomping |
| Log Sources to Investigate | Investigate logs related to email gateways and file sharing platforms to track the distribution of the MS Office document. Examine network logs for unusual activity following the opening of MS Office documents, particularly any connections to known malicious IPs or domains. Utilize endpoint detection and response (EDR) tools to check for execution events related to Office applications that might be leveraging VBA. For example, audit logs that capture VBA macro execution and application behavior anomalies. |
| Key Indicators | Presence of MS Office documents with macros where the VBA source code appears benign or is missing, but they trigger unusual behavior. Detection of any p-code execution without corresponding source code. Identified usage of 'VBA stomping' tools such as Evil Clippy. Inconsistent behavior in MS Office documents compared to typical user activity, such as executing complex operations immediately upon opening. |
| Questions for Analysis | Does the MS Office document contain macros that execute p-code, while the source code appears benign or altered? Has this specific document or a similar one been flagged before for malicious activity? Are there any known associations with the sending email address, domain, or IP with malicious activities? Is there unusual network traffic associated with the documentâ€™s execution, such as traffic to C2 servers? |
| Decision for Escalation | Escalate to Tier 2 if the Office document shows discrepancies between VBA source code and p-code, or if there's a presence of p-code executions seen in network or endpoint behaviors. Also, escalate if the document is from an untrusted source or exhibits high-risk actions such as connecting to suspicious external destinations. |
| Additional Analysis Steps for L1 | Verify the presence of VBA stomping by comparing the VBA source code and p-code. Check if other similar documents were sent to employees. Review sender reputation and any attachment anomalies. Determine if the document has been opened and executed by the end-user. Ensure that AV and EDR systems have scanned the attachment. |
| T2 Analyst Actions | Perform a deeper analysis by extracting and examining both the benign VBA code and p-code using tools that can interpret p-code, like pcodedmp. Evaluate the execution logs from the endpoint to identify any odd behavior. Cross-reference with threat intelligence databases for known malicious indicators. Check for any persistence mechanisms that might have been established as a result of document execution. |
| Containment and Further Analysis | Isolate the affected system if suspicious activity is confirmed. Scan involved files with updated AV/EDR tools. Capture network traffic logs for any anomalies originating from the affected machines. Mitigate further spread by alerting users about potential phishing attempts involving MS Office documents. If a malicious macro executed, perform a full system scan and restore affected applications to a clean state. |
