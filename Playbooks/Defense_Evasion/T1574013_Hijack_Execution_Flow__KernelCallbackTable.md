# Hijack_Execution_Flow:_KernelCallbackTable - T1574013

| Column Name | Value |
|-------------|-------|
| MITRE Tactic | Defense Evasion, Persistence, Privilege Escalation |
| MITRE TTP | T1574.013 |
| MITRE Sub-TTP | T1574.013 |
| Name | Hijack Execution Flow: KernelCallbackTable |
| Log Sources to Investigate | Investigate process monitoring logs to detect unexpected modifications to KernelCallbackTable in processes, specifically monitoring calls to relevant APIs such as WriteProcessMemory, NtQueryInformationProcess, and LoadLibrary calls related to user32.dll. Security Information and Event Management (SIEM) systems should be configured to collect and analyze logs from EDR solutions, Windows Event Logs, and Network Traffic logs to detect anomaly patterns related to process injection or reflective code loading. |
| Key Indicators | Look for the appearance of unexpected or anomalous modifications to KernelCallbackTable or memory writes (ex: WriteProcessMemory) in processes. Indicators also include unusual calls to NtQueryInformationProcess, repeated invocations of SetWindowsHookExA/W or related API functions, and sudden changes in User32.dll related callbacks. Monitor for attempts to restore the KernelCallbackTable shortly after its modification. |
| Questions for Analysis | Is there evidence of WriteProcessMemory or NtQueryInformationProcess being used by non-standard processes? Has there been an unexpected spike in the usage of user32.dll, particularly concerning processes that typically do not interact with GUI functions? Are there coinciding security alerts from endpoint detection systems or unusual network traffic that aligns with the suspicious process behavior? |
| Decision for Escalation | Escalate if unexpected changes are detected in KernelCallbackTable or other memory spaces by non-standard processes, particularly if this involves sensitive systems or there are multiple correlated alerts indicating possible compromise activities. Further escalate if attempts are made to restore or alter KernelCallbackTable back to its original state, suggesting cover-up actions. |
| Additional Analysis Steps for L1 | Validate the existence of observed changes to KernelCallbackTable with multiple log sources (e.g., check both process creation and modification logs). Cross-reference timestamps with network and endpoint security alerts for alignment in activity. Ensure no legitimate software updates or patching activities correspond to the alerts. |
| T2 Analyst Actions | Conduct a deeper analysis on the affected systems by examining memory dumps and snapshots. Use advanced threat hunting tools to trace the source and path of reflective code loading or process injection. Scrutinize related processes for possible persistence mechanisms or lateral movement indicators. Collaborate with relevant teams to match the activities against threat intelligence feeds and known IoCs. |
| Containment and Further Analysis | Should there be strong indications of compromise, initiate immediate containment by quarantining affected systems and blocking associated malicious IPs or domains. Proceed with full memory analysis and forensic imaging to identify additional payloads or backdoors. Collaborate with incident response teams to ensure threat eradication and reestablishing secure operation baselines in affected systems. |
