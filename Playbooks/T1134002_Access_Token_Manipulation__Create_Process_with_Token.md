# Access_Token_Manipulation:_Create_Process_with_Token - T1134002

| Column Name | Value |
|-------------|-------|
| MITRE Tactic | Defense Evasion, Privilege Escalation |
| MITRE TTP | T1134.002 |
| MITRE Sub-TTP | T1134.002 |
| Name | Access Token Manipulation: Create Process with Token |
| Log Sources to Investigate | 1. Security Event Logs: Look for event IDs related to privilege escalation activities, such as 4672 (Special privileges assigned to new logon) and 4688 (A new process has been created).<br>2. Windows Sysmon Logs: Check for Sysmon Event ID 10 indicating process creation with suspicious tokens.<br>3. Process Creation Logs: Monitor logs detailing process invocation, particularly with command-line arguments or parent/child process relationships indicative of token manipulation. 4. Authentication Logs: Review for unusual authentication patterns that might indicate compromised access or lateral movement. 5. Application logs: Check for evidence of use of CreateProcessWithTokenW or similar API calls. |
| Key Indicators | 1. Creation of a new process with mismatched user context or suspicious tokens.<br>2. Presence of CreateProcessWithTokenW API calls in the logs.<br>3. Use of 'runas' command with parameters indicating elevation or account switching. 4. Unusual parent-child process relationships, especially involving high-privilege processes. 5. Repeated or failed attempts to create processes with elevated tokens. |
| Questions for Analysis | 1. Was the process creation aligned with expected user behavior and patterns?<br>2. Does the account associated with the token have a history of privileged access or typical usage at the reported time?<br>3. Are there any documented cases of token impersonation or compromise activity before process creation? 4. Were there any recent logon attempts or successful logins that were unusual or uncharacteristic for the user? |
| Decision for Escalation | Escalate if: 1. The process was created using a high-privilege token without justification or business need.<br>2. There is evidence of anomalous account behavior or lateral movement activities prior to process creation.<br>3. The token used was duplicated or stolen from a known legitimate account through impersonation. 4. Indicators align with known threat actor TTPs related to token abuse. |
| Additional Analysis Steps for L1 | 1. Verify the legitimacy of the user account associated with the token used.<br>2. Cross-reference process creation times with the user's known work schedule and activity logs.<br>3. Review surrounding logs for signs of compromise, such as failed logins or unexpected logon session terminations. 4. Check for presence of runas or CreateProcessWithTokenW API calls at suspicious times. |
| T2 Analyst Actions | 1. Conduct a deeper investigation into the account and its recent activities across the network.<br>2. Analyze additional host and network logs for signs of lateral movement or further exploitation.<br>3. Engage with the affected user to confirm or refute suspicious activities associated with their account. 4. If available, use EDR solutions for detailed process lineage and potential remediation actions. |
| Containment and Further Analysis | 1. Isolate the affected host to prevent further compromise.<br>2. Reset passwords and revoke sessions for the account associated with the manipulated token.<br>3. Conduct a full security audit of the affected systems to ensure similar methods are not currently being used elsewhere. 4. Update detection capabilities to cover the identified method of token manipulation and process creation. 5. Share findings with threat intelligence teams for broader dissemination and alerting. |
