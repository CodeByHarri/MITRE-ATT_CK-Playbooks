# Impair_Defenses:_Impair_Command_History_Logging - T1562003

| Column Name | Value |
|-------------|-------|
| MITRE Tactic | Defense Evasion |
| MITRE TTP | T1562.003 |
| MITRE Sub-TTP | T1562.003 |
| Name | Impair Defenses: Impair Command History Logging |
| Log Sources to Investigate | Investigate logs that can reveal command history tampering, such as:<br>- Shell history files (e.g., ~/.bash_history on Linux and macOS)<br>- PowerShell history logs ($env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt on Windows)<br>- Bash environment variables changes, especially HISTFILE and HISTCONTROL<br>- PowerShell logs and command execution records<br>- Syslog and security events that might capture shell access or command execution<br>- Audit logs from network devices that track CLI command executions<br>- Configuration management systems for changes in command history settings. |
| Key Indicators | Look for these indicators:<br>- Absence or manipulation of ~/.bash_history file on compromised accounts<br>- Unset HISTFILE command in shell history<br>- HISTFILESIZE set to 0 in environment variables<br>- HISTCONTROL set to 'ignorespace' or 'ignoreboth'<br>- Space-prepended commands in command logs<br>- PowerShell history path changes with Set-PSReadLineOption<br>- PSReadLineOption set to SaveNothing<br>- Unusual timestamps, missing logs, or history file discrepancies<br>- 'no logging' command issued on network devices. |
| Questions for Analysis | Tier 1 analysts should ask:<br>- Is there a legitimate reason for command history logging being disabled or redirected?<br>- Are there known scripts or administration tools that alter HISTFILE or PSReadLine settings in this way?<br>- Have there been any other suspicious activities or alerts associated with this account or system?<br>- Is this behavior consistent with internal policy or historical usage patterns? |
| Decision for Escalation | Escalate to Tier 2 if:<br>- There is no clear business justification for the changes to command history logging.<br>- The user account associated with these activities has shown other suspicious behavior.<br>- There is an absence of logs or other anomalies that suggest tampering.<br>- You are unable to verify cause or justification after initial checks. |
| Additional Analysis Steps for L1 | For Level 1 analysts:<br>- Verify if changes are matching legitimate activities by checking change management records.<br>- Review user activity and job role to determine if command history tampering is part of expected behavior.<br>- Check for concurrent unusual network connections or system changes.<br>- Identify if multiple endpoints show similar tampering signs, indicating a potential broader attack. |
| T2 Analyst Actions | For Tier 2 analysts:<br>- Conduct deeper audit of file system for hidden indicators of tampering or malware residue.<br>- Verify timelines of abnormal log settings with known exploits or malware signatures.<br>- Perform a deeper inspection of environment variable history and configuration files for systemic changes.<br>- Cross-correlate the suspicious behavior with other IT incidents or intelligence gathered through threat intelligence platforms. |
| Containment and Further Analysis | Containment and analysis steps:<br>- Reinstate command logging and restrict user permissions where unauthorized changes were identified.<br>- Isolate affected systems if malicious behavior or compromise is confirmed.<br>- Utilize endpoint detection and response (EDR) solutions to conduct a sweep for other potentially compromised systems.<br>- Engage with network device teams to check CLI configurations are secure.<br>- Notify impacted users of potential compromise for further education and adjustment of security policies. |
